<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en-us">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <title>mp5 help</title>
  <meta name="author" content="P. J. Durka">
  <meta name="description" content="mp5 is a program for matching pursuit decomposition of signals">
</head>
<body>
<h1><a name="mozTocId65000"></a>General Overview</h1>

<p><strong>mp5</strong> is the 5th version of&nbsp;software for
<span style="font-weight: bold;">m</span>atching
<span style="font-weight: bold;">p</span>ursuit
decomposition, developped between 1999 and 2012 at the
<a href="http://www.uw.edu.pl">University of Warsaw</a>
(<a href="http://brain.fuw.edu.pl">Department of Biomedical Physics</a>,
<a href="http://www.fuw.edu.pl">Institute of Experimental Physics</a>).
Algorithm is based upon the seminal paper by Mallat and Zhang
<a href="#ref:Mallat1993">(Mallat1993)</a> with modifications described partly
by Durka et al. <a href="#ref:stochmp">(Durka2001)</a> and Kuś et al.
<a href="#ref:OGD">(Kuś2013)</a>. For a wider list of references,
detailed description of the algorithm, and EEG applications, see
<a href="#ref:Uni">(Durka 2007a)</a>. MP5 is written in C, with source code
available on Gnu Public License <a href="http://www.gnu.org/licenses/gpl.html">GPLv2</a>.</p>

<p>MP5 is written for batch procesing time series, using datasets and parameters
defined in the config file, and writting results to disk files
called&mdash;after&nbsp;<a href="#ref:Mallat1993">(Mallat1993)</a>&mdash;"decomposition books".
These books (default *.b) contain parameters of the time-frequency atoms
(currently Gabor functions, Dirac's deltas and sines), selected for the
representation of the analyzed signal from a redundant set (dictionary),
generated prior to the decomposition. The program can be used in two ways:</p>

<ol>
  <li>Using the signalml interface, which creates a config and runs mp5.</li>
  <li>Directly from the command line, in which case we must prepare a valid
  config file. <a href="#mozTocId888888">Example config</a> is generated by
  calling <code>mp5 -g</code>, and written to the file "mp5_default.set"</li>
</ol>

<p>The latter is supposed to be user-friendly, and simplifies access to the input
data in different formats using the SignalML description. However, both of these
cases require from the user at least basic understanding of at least basic
settings.</p>

<p style="font-size:x-large; font-family:monospace;"><span style="color:red;">mp5</span>:
matching pursuit decomposition of signals</p>

<ul id="mozToc">
    <li><a href="#mozTocId65000">General overview</a>
    <li><a href="#mozTocId65335">MP5 setting. The structure of config file</a>
    <ul>
        <li><a href="#mozTocId65336">Comments in the config file</a>
        <li><a href="#mozTocId346163">Input settings &mdash; obligatory settings</a>
        <ul>
            <li><a href="#mozTocId151805">nameOfDataFile</a>
            <li><a href="#mozTocId151806">nameOfOutputDirectory</a>
            <li><a href="#mozTocId668756">writingMode</a>
            <li><a href="#mozTocId291133">samplingFrequency</a>
            <li><a href="#mozTocId894346">numberOfChannels</a>
            <li><a href="#mozTocId84630">selectedChannels</a>
            <li><a href="#mozTocId30867">numberOfSamplesInEpoch</a>
            <li><a href="#mozTocId39994">selectedEpochs</a>
            <li><a href="#mozTocId680479">typeOfDictionary</a>
            <li><a href="#mozTocId702486">energyError</a>
            <li><a href="#mozTocId428231">randomSeed</a>
            <li><a href="#mozTocId428232">reinitDictionary</a>
            <li><a href="#mozTocId430305">maximalNumberOfIterations</a>
            <li><a href="#mozTocId475202">energyPercent</a>
            <li><a href="#mozTocId484043">MP</a>
            <li><a href="#mozTocId431173">scaleToPeriodFactor</a>
            <li><a href="#mozTocId296490">pointsPerMicrovolt</a>
        </ul>
        <li><a href="#mozTocId836024">Input settings &mdash; additional settings</a>
        <ul>
            <li><a href="#mozTocId100001">normType</a>
            <li><a href="#mozTocId100002">diracInDictionary</a>
            <li><a href="#mozTocId100003">gaussInDictionary</a>
            <li><a href="#mozTocId100004">sinCosInDictionary</a>
            <li><a href="#mozTocId100005">gaborInDictionary</a>
            <li><a href="#mozTocId100006">progressBar</a>
        </ul>
    </ul>
    <li><a href="#mozTocId888888">Example configuration file</a>
    <li><a href="#mozTocId999999">References</a>
</ul>

<h1><a name="mozTocId65335"></a>MP5 setting. The structure of config file</h1>

<p>The config file of mp5 software is consisted of lines,
which can be divided into three groups:</p>

<ul>
    <li>Comments.
    <li>Obligatory command.
    <li>Additional commands.
</ul>

<p>Each line, which is not a comment is treated as command for the program. Each command is consisted of its name and value.
If there is a lack of Obligatory Command, the mp5 will return error. If the user do not set the additional commands,
the mp5 set the default values. The order of lines with commands in config file is arbitrary.</p>

<h2><a name="mozTocId65336"></a>Comments in the config file</h2>
<p>The user can add his own comments to the configuration file by placing a #
sign in front of the line. There are two type of comments:</p>
<ul>
    <li>lines starting with # are treated as comments and will exist only in the config file, but will be
    neglected by mp5, for example:<br>
    <code># Moly set the numberOfChannels to 5</code>
    <li>lines starting with ## are also treated as comments but they will be
    copied to the output file (book) with results, like:<br>
    <code>## channels selected above motor cortex decomposed with very small dictionary</code>
</ul>
<p>Although in general the results are written to the binary file,
the comments are saved as text and can be viewed by standard text editor.</p>

<h2><a name="mozTocId346163"></a>Input settings &mdash; obligatory settings</h2>
<!--In the signalml interface, these prameters are to a large extent filled in automatically to represent the currently loaded signal and
selections.-->
It is expected that file containing the signal for mp5 program will fulfill the following requirements:
<ul>
    <li>the signal will be saved in binary file as a 4-byte float numbers
    <li>order of samples in file will be as in multiplex sequence, that means:<br>
    s1ch1, s1ch2, …, s1chK, s2ch1, s2ch2, …, s2chK<br>
    where sXchY is the X-th sample at channel Y, K is the number of channels
</ul>

<h3><a name="mozTocId151805"></a>nameOfDataFile</h3>
<p>Full path to the input file.</p>

<h3><a name="mozTocId151806"></a>nameOfOutputDirectory</h3>
<p>The path to the output directory, where the file with results should be saved.
The default is the same as location of the input file.</p>

<h3><a name="mozTocId668756"></a>writingMode</h3>
<ul>
    <li><code>CREATE</code> &mdash; create a new file for results writing,
    replace an already existing file with same name
    <li><code>APPEND</code> &mdash; append the results to an already existing file
    or create a new file if there is no file to append to
</ul>
<p>Names of the output files are generated automatically; the name of the file
with the data is appended with: <code style="color:red;">_smp.b</code> in case
of a single channel mp algorithm (SMP), or <code style="color:red;">_mmp.b</code>
in case of one of the multichannel mp algorithms (MMP1, MMP2, MMP3).</p>
<p>The results file (book) includes the original analyzed epoch
in the file containing decomposition.</p>

<h3><a name="mozTocId291133"></a>samplingFrequency</h3>
<p>Floating-point positive number. Decimal dot is obligatory, that is "<code>128.0</code>"
and not "<code>128</code>".</p>

<h3><a name="mozTocId894346"></a>numberOfChannels</h3>
<p>Number of channels in the input file. Positive integer.</p>

<h3><a name="mozTocId84630"></a>selectedChannels</h3>

<p>In either of the algorithms&mdash;monochannel or multivariate&mdash;one does
not have to use all the channels present in the data file. For example,
using SMP we may decompose only few channels, and for MMP we may need
to neglect non-EEG channels. This option lists the channels which we
want to analyze. That is, to analyze all the channels from a 20-channel
datafile config must contain:</p>
<pre>numberOfChannels 20
selectedChannels 1-20</pre>

<p>Channels are numbered starting from 1. Selection is written
either as comma-separated list 1,2,3 or as ranges 1-3. Both can be
combined in one line, e.g.:</p>
<pre>selectedChannels 1, 3, 5, 7-11, 19</pre>

<h3><a name="mozTocId30867"></a>numberOfSamplesInEpoch</h3>
<p>When decomposing susequent epochs of a long signal, this option
determines the length of the epoch measured as number of samples.
Argument's value: positive integer.</p>

<h3><a name="mozTocId39994"></a>selectedEpochs</h3>
<p>Chooses which epochs (of the length defined by <code>numberOfSamplesInEpoch</code>)
will be analysed. First epoch in the file is number 1. Written as comma-separated
list with ranges as in <code>selectedChannels</code>. This command is obligatory.</p>

<h3><a name="mozTocId680479"></a>typeOfDictionary</h3>
<ul>
    <li><code>OCTAVE_FIXED</code> &mdash; functions distributed in a way to
    optimally cover the ranges of parameters reasonable for a given signal
    in a way that the distance between any two neighboring functions
    does not exceed the threshold given by a user <a href="#ref:OGD">(Kuś2013)</a>
    <li><code>OCTAVE_STOCH</code> &mdash; distribution as in <code>OCTAVE_FIXED</code>,
    plus a stochastic element to remove the possible bias <a href="#ref:stochmp">(Durka et al. 2001)</a>.
    The dictionary with Gabors is created according to the first parameter energyError command,
    but in the next randomly selected Gabors are remove from dictionary. The number of atoms left
    is controlled by second parameter of errorEnergy command.
</ul>

<h3><a name="mozTocId702486"></a>energyError</h3>
<p>This parameter regulates the density of the dictionary. That is, for the same energyError,
and different sizes of the analyzed epoch, effective sizes of the dictionary will be
larger for longer epochs, but accuracy of the decomposition should be equivalent
(except for the border effects). Formule are given in <a href="#ref:OGD">(Kuś2013)</a>.
<span style="color:red;">Clicking [compute sizes] in the signalml interface
gives a raw approximation (upper limit) of the number of atoms in the dictionary
and resulting usage of RAM.</span>.</p>

<p>The energyError parameter has two values:</p>
<ul>
    <li>the first one is a threshold for a distance between two nearest atom in dictionary,
    this value should be in range (0 1)
    <li>the second is value percentage of atoms left after stochastic dictionary reduction;
    this value is omited by mp5, when typeOfDictionary is set to OCTAVE_FIXED
</ul>

<p>For example, the configuration of commands:</p>
<pre><code>typeOfDictionary OCTAVE_FIXED
energyError 0.3 30.0</code></pre>
<p>results in generation of dictionary in which the maximal distance between nearest Gabors does not exceed value 0.3.</p>

<p>With another configuration:</p>
<pre><code>typeOfDictionary OCTAVE_STOCH
energyError 0.3 40.0</code></pre>
<p>the distribution of the atoms in dictionary is performed in such way that
the maximal distance between nearest Gabors does not exceed value 0.3.
After generation of the dictionary, the number of Gabors will be reduced to
40% of their initial amount (related to the threshold 0.3) by random selection.</p>

<h3><a name="mozTocId428231"></a>randomSeed</h3>
<p>In case of the generation stochastic dictionary, use the <i>seed</i> for
random generator from the config file or generated from cimputer's clock.</p>
<p>For example:</p>
<pre><code>randomSeed 23432</code></pre>
<p>The mp5 will used this number as a seed for random generator.
The <i>seed</i> is the same for any stichastic reinitialization of the dcitionary
(see the next command - reinitDictionary).</p>
<p>Second example:</p>
<pre><code>randomSeed auto</code></pre>
<p>The mp5 will used the time form the computer's clock as a seed of random generator.
The <i>seed</i> is different for any reinitialization of the dictionary.</p>

<h3><a name="mozTocId428232"></a>reinitDictionary</h3>
<p>When using the default stochastic (randomized) dictionary, the
randomization of parameters is called reinitialization of the
dictionary. It can be performed:</p>
<ul>
    <li><code>REINIT_AT_ALL</code> &mdash; at each of the
    analyzed epochs, works only for <code>SMP</code>.
    <li><code>REINIT_IN_CHANNEL_DOMAIN</code> &mdash; exactly the same
    dictionary will be used to decompose all
    epochs within a channel. Before the analysis of another
    channel, parameters will be reinitializse, i.e. randomized again. This
    setting can be applied only in the case of separate decomposition of
    channels using <code>SMP</code> option.
    <li><code>REINIT_IN_OFFSET_DOMAIN</code> &mdash; dictionary will be
    reinitialized before decomposing each subsequent epoch.
    <li><code>NO_REINIT_AT_ALL</code> &mdash; one and same
    dictionary for decompositions in all channels and all
    epochs.
</ul>

<h3><a name="mozTocId430305"></a>maximalNumberOfIterations</h3>
<p>Maximum number of iterations equals the largest allowed numbers of
waveforms, fitted to the analyzed epoch. The iterations stop either
after reaching this number, or after explaining the percentage of
signal's energy set in the energyPercent parameter, whatever comes
first. That is, if we want to force the decomposition to contain
exactly&nbsp;<code>maximalNumberOfIterations</code>
iterations, we should set <code>energyPercent</code>
to 100.</p>
<p>The current and next commend regulate the number of waveforms used for the
approximation of the analyzed epoch ,which equals the number of
algorithms iteration performed before the stopping criterion is
fulfilled. It does not influence the accuracy of the parameters of the
waveforms fitted to the signal, in the sense that the&nbsp;5
waveforms fitted to the signal in 5 iterations run will be just as good
as the first 5 fitted in the 100 iterations run.</p>
<p>Time of computations is proportional to the number of algoritms
iterations (except for the longer the first iteration), and obviously
with more iteration we explain larger amount of signal's energy,
although too many iterations usually make no sense. Unfortunately, the
meaning of "too many" depends on the properties of the signal and the
aim of decomposition. For further considerations consult e.g. <a href="#ref:Uni">(Durka2007a)</a>
and <a href="#ref:Scholarpedia">(Durka2007b)</a>.</p>

<h3><a name="mozTocId475202"></a>energyPercent</h3>
<p>Algorithm stops after explaining <code>energyPercent</code>% of the energy
of the analyzed epoch, that is, when the sum of energies of functions fitted
to the signals reaches <code>energyPercent</code>% of
the signal's energy, unless <code>maximalNumberOfIterations</code>
was reached first.</p>

<h3><a name="mozTocId484043"></a>MP</h3>
<p>There are significant differences between the 'classical' MP computed
for the univariate time series,&nbsp;and the variety of possible
versions of the multuchannel MP. This choice is regulated by the MP
variable, which can be assigned one of the following values. For
equations and formulae see <a href="#ref:Uni">(Durka&nbsp;2007a)</a>.</p>
<ul>
    <li><code>SMP</code> &mdash;
    monochannel MP (separate decomposition of single channel)
    <li><code>MMP1</code> &mdash;
    multichannel algorithm maximizing in each iteration the sum of energies
    explained in all channels
    <li><code>MMP2</code> &mdash;
    suboptimal, faster version of <code>MMP1</code>
    maximizing in each iteration the sum of products of the waveform with
    all the channels. In theory may degrade in the case when opposite
    polarities are present across channels
    <li><code>MMP3</code> &mdash; as <code>MMP1</code>, but allowing
    different phases in each channel.
</ul>

<h3><a name="mozTocId431173"></a>scaleToPeriodFactor</h3>
<p>All Gabor functions, for which the number of&nbsp;periods of the
sine, given by this parameter, exceeds the half-width of the
Gaussian,&nbsp;will be removed from the dictionary. It regulates
removal of non-physical cases. For example,&nbsp;1 Hz oscillation
which lasts 100 milliseconds mathematically represents a well defined
waveform. However,&nbsp;the very notion of frequency is dubious in
such case. Also, the actul peek-to-peek amplitude of such function may
significantly differ from the doubled amplitude of the Gaussian
envelope.</p>

<h3><a name="mozTocId296490"></a>pointsPerMicrovolt</h3>
<p>Conversion rate from the actual values stored in the datafile to
physical units, for EEG microvolts [µV], for MEG femtotesla [fT].</p>

<p>Decimal dot is obligatory. For example,</p>
<pre><code>pointsPerMicrovolt 20.0</code></pre>
<p>in EEG file says that the stored vaules must be multiplied
by 20 to get microvolts.</p>

<h2><a name="mozTocId836024"></a>Input parameters &mdash; additional settings</h2>

<h3><a name="mozTocId100001"></a>normType</h3>
<p>The experimental feature of mp5 program, do not change it. The default value is set to L2.</p>

<h3><a name="mozTocId100002"></a>diracInDictionary</h3>
<p>Generate dictionary including Dirac Function. The possible argument of command is YES or NO string.</p>

<h3><a name="mozTocId100003"></a>gaussInDictionary</h3>
<p>Generate dictionary including Gauss Function. The possible argument of command is YES or NO string.</p>

<h3><a name="mozTocId100004"></a>sinCosInDictionary</h3>
<p>Generate dictionary including Harmonic function. The possible argument of command is YES or NO string.</p>

<h3><a name="mozTocId100005"></a>gaborInDictionary</h3>
<p>Generate dictionary including Gabor functions. The possible argument of command is YES or NO string.</p>

<h3><a name="mozTocId100006"></a>progressBar</h3>
<p>Plot text bar representing the progress of calculation. The possible argument of command is YES or NO string.</p>

<!--
<h3><a class="mozToch3" name="mozTocId896030"></a>analiticalDotProduct</h3>
experimental.<br>
<br>
-->

<h1><a name="mozTocId888888"></a>Example configuration file</h1>
<pre>
# OBLIGATORY PARAMETERS
nameOfDataFile         test.dat
nameOfOutputDirectory  ./
writingMode            CREATE
samplingFrequency      128.0
numberOfChannels       24
selectedChannels       1-19
numberOfSamplesInEpoch 179
selectedEpochs         1-31
typeOfDictionary       OCTAVE_FIXED
energyError            0.3 50.0
randomSeed             auto
reinitDictionary       NO_REINIT_AT_ALL
maximalNumberOfIterations 100
energyPercent             95.0
MP                        SMP
scaleToPeriodFactor       1.0
pointsPerMicrovolt        1.0

# ADDITIONAL PARAMETERS
normType                  L2
diracInDictionary         YES
gaussInDictionary         YES
sinCosInDictionary        YES
gaborInDictionary         YES
progressBar               ON
</pre>

<hr>
<h1><a name="mozTocId999999"></a>References</h1>

<p><a name="ref:Mallat1993"></a>(Mallat1993) St&eacute;phane Mallat and Zhifeng Zhang<br>
Matching pursuit with
time-frequency dictionaries. <span style="font-style: italic;">IEEE
Transactions on Signal Processing</span>
1993,
41:3397-3415</p>

<p><a name="ref:Uni"></a>(Durka2007a) Piotr J. Durka<br>
<a style="font-style:italic;" href="http://brain.fuw.edu.pl/%7Edurka/UNI.html">Matching
Pursuit and Unification in EEG analysis</a>,
Artech House 2007, ISBN 978-1-58053-304-1</p>

<p><a name="ref:Scholarpedia"></a>(Durka2007b) Piotr J. Durka<br>
<a href="http://www.scholarpedia.org/article/Matching_pursuit">Matching Pursuit</a>,
Scholarpedia, p. 20910, 2007.</p>

<p><a name="ref:OGD"></a>(Kuś2013) Rafał Kuś, Piotr T. Różański and Piotr J. Durka<br>
Optimal sampling of Gabor dictionaries
(submitted to <span style="font-style: italic;">Neuroinformatics</span>)</p>

<p><a name="ref:stochmp"></a>(Durka2001) Piotr J. Durka, D. Ircha and K. J. Blinowska<br>
Stochastic time-frequency dictionaries for Matching Pursuit,
<span style="font-style: italic;">IEEE Transactions on Signal Processing</span>, vol. 49,
No. 3, pp. 507-510, March 2001.</p>

</body>
</html>
